<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- FEATURE 3: Disguised Title for Browser Tabs -->
    <title>Daily Calculator</title>
    
    <!-- FEATURE 3: Disguised PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiRGFpbHkgQ2FsY3VsYXRvciIsInNob3J0X25hbWUiOiJDYWxjdWxhdG9yIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwMjA2MTciLCJ0aGVtZV9jb2xvciI6IiMwMjA2MTciLCJvcmllbnRhdGlvbiI6InBvcnRyYWl0IiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vY2dnLmNvbS9hcGkvdjEvZ2V0X2ltYWdlP2ltYWdlX3VybD1odHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTU4NzE0NTgyOTYwNS00MTA1YTRjMGNmZDA/aXg9dXJsJnF1YWxpdHk9ODUmdz0xOTIiLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dfQ==">
    
    <!-- iOS / PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Calculator">
    <meta name="theme-color" content="#020617">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617; /* Midnight Blue Base */
            /* Aesthetic: Deep, calming gradient mesh */
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(79, 70, 229, 0.15) 0%, transparent 50%), 
                radial-gradient(circle at 100% 100%, rgba(244, 63, 94, 0.1) 0%, transparent 50%),
                linear-gradient(to bottom, #020617, #0f172a);
            color: #f8fafc;
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        /* Hide Scrollbar */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; -webkit-tap-highlight-color: transparent; }
        
        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .glass-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.01) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .glass-card:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.08);
        }

        /* Animations */
        .pulse-soft {
            animation: pulse-soft 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .pulse-urgent {
            animation: pulse-urgent 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.0); }
            50% { opacity: 0.9; transform: scale(1.02); box-shadow: 0 0 20px rgba(244, 63, 94, 0.1); }
        }

        @keyframes pulse-urgent {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 30px rgba(244, 63, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); }
        }

        /* Tech/Grid Overlay */
        .tech-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            mask-image: radial-gradient(circle at 50% 50%, black 40%, transparent 100%);
        }

        .animate-in { animation: fadeSlideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .loader-ring {
            width: 48px; height: 48px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #fb7185; /* Soft Coral */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex flex-col items-center justify-center h-screen bg-[#020617] text-slate-400">
            <div class="loader-ring mb-4"></div>
            <p class="text-xs font-medium tracking-[0.2em] uppercase opacity-60">Initializing Security Layer</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef, Component } = React;

        // --- ERROR BOUNDARY ---
        class ErrorBoundary extends Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            componentDidCatch(error, errorInfo) { console.error("Critical Error:", error, errorInfo); }
            render() {
                if (this.state.hasError) {
                    return (
                        <div className="flex flex-col items-center justify-center h-screen bg-[#020617] p-8 text-center">
                            <div className="w-16 h-16 bg-rose-500/10 rounded-full flex items-center justify-center mb-6 ring-1 ring-rose-500/30">
                                <svg className="w-8 h-8 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                            </div>
                            <h2 className="text-xl font-bold text-white mb-2">System Interrupted</h2>
                            <p className="text-slate-400 text-sm mb-6">The security layer encountered an unexpected issue.</p>
                            <button onClick={() => window.location.reload()} className="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-all text-sm tracking-wide">REBOOT SYSTEM</button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // --- FIREBASE SETUP ---
        let auth, db;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'raksha-x-demo';
        const mockStorage = {}; 

        const initializeServices = () => {
            let isRealFirebase = false;
            try {
                if (typeof firebase !== 'undefined' && firebase.apps && typeof __firebase_config !== 'undefined') {
                    const configStr = __firebase_config;
                    if (configStr) {
                        const firebaseConfig = JSON.parse(configStr);
                        if (firebaseConfig && firebaseConfig.apiKey) {
                            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                            auth = firebase.auth();
                            db = firebase.firestore();
                            isRealFirebase = true;
                            auth.onAuthStateChanged(user => { if (!user) auth.signInAnonymously().catch(e => console.error("Auth Failed", e)); });
                        }
                    }
                }
            } catch (e) { console.warn("Firebase Init Error", e); }

            if (!isRealFirebase) {
                auth = {
                    onAuthStateChanged: (cb) => { setTimeout(() => cb({ uid: 'demo-user', displayName: 'Guardian' }), 800); return () => {}; },
                    signInWithPopup: () => Promise.resolve(),
                    signInAnonymously: () => Promise.resolve(),
                    signOut: () => { window.location.reload(); },
                    currentUser: { uid: 'demo-user', displayName: 'Guardian' }
                };
                const createMockCollection = (path) => ({
                    doc: () => ({
                        collection: () => createMockCollection(),
                        set: () => Promise.resolve(),
                        get: () => Promise.resolve({ exists: false, data: () => ({}) }),
                        delete: () => Promise.resolve(),
                        add: () => Promise.resolve(),
                        onSnapshot: (cb) => { cb({ docs: [] }); return () => {}; }
                    }),
                    add: () => Promise.resolve({ id: 'mock-' + Date.now() }),
                    onSnapshot: (cb) => { cb({ docs: [] }); return () => {}; }
                });
                db = { collection: () => createMockCollection() };
            }
        };
        initializeServices();

        // --- ICON COMPONENT ---
        const Icon = ({ name, className, ...props }) => {
            const [isLoaded, setIsLoaded] = useState(typeof lucide !== 'undefined');
            useEffect(() => {
                if (isLoaded) return;
                const interval = setInterval(() => { if (typeof lucide !== 'undefined') { setIsLoaded(true); clearInterval(interval); } }, 100);
                return () => clearInterval(interval);
            }, [isLoaded]);

            if (!isLoaded || !lucide) return <span className={`inline-block w-5 h-5 bg-white/5 rounded ${className}`} />;

            let iconName = name;
            const map = { 'LayoutDashboard': 'Layout', 'ShieldCheck': 'Shield', 'Megaphone': 'Speaker' };
            if (!lucide.icons[iconName] && map[iconName] && lucide.icons[map[iconName]]) iconName = map[iconName];
            if (!lucide.icons[iconName]) return <span className={`inline-block w-5 h-5 bg-white/5 rounded ${className}`} />;
            
            try {
                const svgElement = lucide.createElement(lucide.icons[iconName]);
                if (className) svgElement.setAttribute('class', `${svgElement.getAttribute('class') || ''} ${className}`.trim());
                Object.keys(props).forEach(key => svgElement.setAttribute(key.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase(), props[key]));
                return <span dangerouslySetInnerHTML={{ __html: svgElement.outerHTML }} style={{ display: 'inline-flex', alignItems: 'center', lineHeight: 0 }} />;
            } catch (err) { return null; }
        };

        const Logo = () => (
            <div className="flex items-center gap-3 select-none">
                <div className="relative flex items-center justify-center w-8 h-8 rounded-lg bg-gradient-to-tr from-indigo-500 to-violet-500 shadow-lg shadow-indigo-500/20">
                    <Icon name="Shield" className="text-white w-4 h-4" />
                </div>
                <span className="text-lg font-bold tracking-tight text-white">Raksha<span className="text-rose-400">X</span></span>
            </div>
        );

        // --- SIREN AUDIO ENGINE ---
        class SirenManager {
            constructor() { this.audioCtx = null; this.oscillator = null; this.gainNode = null; this.lfo = null; this.lfoGain = null; }
            start() {
                try {
                    if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    if (this.audioCtx.state === 'suspended') this.audioCtx.resume();
                    this.oscillator = this.audioCtx.createOscillator(); this.oscillator.type = 'sawtooth'; this.oscillator.frequency.value = 800;
                    this.gainNode = this.audioCtx.createGain(); this.gainNode.gain.value = 0.5;
                    this.lfo = this.audioCtx.createOscillator(); this.lfo.type = 'sine'; this.lfo.frequency.value = 2; 
                    this.lfoGain = this.audioCtx.createGain(); this.lfoGain.gain.value = 400;
                    this.lfo.connect(this.lfoGain); this.lfoGain.connect(this.oscillator.frequency);
                    this.oscillator.connect(this.gainNode); this.gainNode.connect(this.audioCtx.destination);
                    this.oscillator.start(); this.lfo.start();
                } catch (e) { console.error("Audio Error:", e); }
            }
            stop() {
                try {
                    if (this.oscillator) { this.oscillator.stop(); this.oscillator.disconnect(); this.oscillator = null; }
                    if (this.lfo) { this.lfo.stop(); this.lfo.disconnect(); this.lfo = null; }
                } catch (e) {}
            }
        }

        // --- VIEWS ---

        const ContactsView = ({ user, onBack }) => {
            const [contacts, setContacts] = useState([]);
            const [isAdding, setIsAdding] = useState(false);
            const [newContact, setNewContact] = useState({ name: '', phone: '', relation: '' });

            useEffect(() => {
                if (!user) return;
                const unsub = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('contacts').onSnapshot(snap => {
                    setContacts(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                });
                return () => unsub();
            }, [user]);

            const handleAdd = async (e) => {
                e.preventDefault();
                if (!newContact.name || !newContact.phone) return;
                await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('contacts').add({
                    name: newContact.name, phone: newContact.phone, relation: newContact.relation || 'Contact', createdAt: new Date().toISOString()
                });
                setNewContact({ name: '', phone: '', relation: '' }); setIsAdding(false);
            };

            const handleDelete = async (id) => {
                if (confirm("Remove contact?")) await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('contacts').doc(id).delete();
            };

            return (
                <div className="h-full flex flex-col px-6 pb-24 overflow-y-auto animate-in">
                    <div className="flex items-center justify-between py-6">
                        <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                        <h2 className="text-lg font-semibold text-white tracking-wide">Trusted Guardians</h2>
                        <button onClick={() => setIsAdding(!isAdding)} className={`p-2 rounded-full glass-card ${isAdding ? 'text-rose-400' : 'text-emerald-400'}`}><Icon name={isAdding ? "X" : "Plus"} className="w-5 h-5" /></button>
                    </div>

                    {isAdding && (
                        <div className="mb-6 glass-panel p-5 rounded-2xl animate-in border-l-4 border-emerald-500">
                            <h3 className="text-sm font-bold text-white mb-4">New Guardian Details</h3>
                            <form onSubmit={handleAdd} className="space-y-3">
                                <input type="text" placeholder="Name" className="w-full bg-slate-900/50 border border-slate-700/50 rounded-xl px-4 py-3 text-sm text-white focus:border-emerald-500 outline-none" value={newContact.name} onChange={e => setNewContact({...newContact, name: e.target.value})} />
                                <input type="tel" placeholder="Phone" className="w-full bg-slate-900/50 border border-slate-700/50 rounded-xl px-4 py-3 text-sm text-white focus:border-emerald-500 outline-none" value={newContact.phone} onChange={e => setNewContact({...newContact, phone: e.target.value})} />
                                <button type="submit" className="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-xl text-sm transition-colors">Add to Safety Circle</button>
                            </form>
                        </div>
                    )}

                    <div className="space-y-3">
                        {contacts.length === 0 ? (
                            <div className="text-center py-20 opacity-50">
                                <Icon name="Shield" className="w-12 h-12 mx-auto mb-3 text-slate-500" />
                                <p className="text-sm text-slate-400">No guardians added yet.<br/>Your safety circle is empty.</p>
                            </div>
                        ) : (
                            contacts.map(c => (
                                <div key={c.id} className="glass-card p-4 rounded-2xl flex items-center justify-between group">
                                    <div className="flex items-center gap-4">
                                        <div className="w-10 h-10 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center font-bold border border-indigo-500/20">
                                            {c.name.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <p className="text-white font-medium text-sm">{c.name}</p>
                                            <p className="text-xs text-slate-400">{c.phone}</p>
                                        </div>
                                    </div>
                                    <button onClick={() => handleDelete(c.id)} className="p-2 text-slate-600 hover:text-rose-400 transition-colors"><Icon name="Trash2" className="w-4 h-4" /></button>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        const HomeView = ({ user, setView }) => {
            const [activeSOS, setActiveSOS] = useState(false);
            const [sirenOn, setSirenOn] = useState(false);
            const [timer, setTimer] = useState(5);
            const sirenRef = useRef(null);
            const intervalRef = useRef(null);

            useEffect(() => { sirenRef.current = new SirenManager(); return () => sirenRef.current.stop(); }, []);

            const toggleSiren = () => {
                if (sirenOn) { sirenRef.current.stop(); setSirenOn(false); }
                else { sirenRef.current.start(); setSirenOn(true); }
            };

            const toggleSOS = () => {
                if (activeSOS) {
                    setActiveSOS(false);
                    clearInterval(intervalRef.current);
                    setTimer(5);
                } else {
                    setActiveSOS(true);
                    intervalRef.current = setInterval(() => {
                        setTimer(t => {
                            if (t <= 1) {
                                clearInterval(intervalRef.current);
                                alert("SOS SIGNAL SENT to Guardians!");
                                setActiveSOS(false);
                                return 5;
                            }
                            return t - 1;
                        });
                    }, 1000);
                }
            };

            return (
                <div className="flex flex-col h-full px-6 pb-28 animate-in overflow-y-auto no-scrollbar">
                    {/* Header */}
                    <div className="flex justify-between items-center mt-6 mb-8">
                        <div>
                            <h1 className="text-xl font-bold text-white tracking-wide">Hi, {user?.displayName || 'Guardian'}</h1>
                            <div className="flex items-center gap-2 mt-1">
                                <span className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                                <p className="text-xs text-emerald-400 font-medium tracking-wider">SECURE CONNECTION</p>
                            </div>
                        </div>
                        <div className="p-2.5 rounded-full glass-card border border-white/5">
                            <Icon name="ShieldCheck" className="w-5 h-5 text-indigo-400" />
                        </div>
                    </div>

                    {/* SOS Section */}
                    <div className="flex-1 flex flex-col items-center justify-center min-h-[340px] relative">
                        {/* Background Rings */}
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-20">
                            <div className={`w-64 h-64 rounded-full border border-rose-500/30 transition-all duration-1000 ${activeSOS ? 'scale-110 opacity-100' : 'scale-100'}`}></div>
                            <div className={`absolute w-80 h-80 rounded-full border border-rose-500/10 transition-all duration-1000 delay-100 ${activeSOS ? 'scale-110 opacity-100' : 'scale-100'}`}></div>
                        </div>

                        <button 
                            onClick={toggleSOS}
                            className={`relative w-48 h-48 rounded-full flex flex-col items-center justify-center transition-all duration-500 z-10 shadow-2xl
                                ${activeSOS 
                                    ? 'bg-rose-500 text-white pulse-urgent shadow-[0_0_60px_rgba(244,63,94,0.5)]' 
                                    : 'glass-card hover:bg-slate-800/50 border-white/10 pulse-soft shadow-[0_0_40px_rgba(0,0,0,0.3)]'
                                }`}
                        >
                            {activeSOS ? (
                                <span className="text-6xl font-black font-mono tracking-tighter">{timer}</span>
                            ) : (
                                <>
                                    <Icon name="Fingerprint" className="w-16 h-16 text-rose-400 mb-3 opacity-90" strokeWidth={1} />
                                    <span className="text-xs font-bold text-rose-400 tracking-[0.2em] uppercase">Hold SOS</span>
                                </>
                            )}
                        </button>
                        <p className="mt-8 text-xs text-slate-500 uppercase tracking-widest font-medium">
                            {activeSOS ? "Tap to Cancel" : "Emergency Beacon"}
                        </p>
                    </div>

                    {/* Grid Actions */}
                    <div className="grid grid-cols-2 gap-3 mt-6">
                        <button onClick={() => setView('contacts')} className="glass-card p-4 rounded-2xl flex flex-col items-center gap-3 active:scale-95 group">
                            <div className="p-3 rounded-full bg-indigo-500/10 text-indigo-400 group-hover:bg-indigo-500/20 transition-colors">
                                <Icon name="Users" className="w-6 h-6" />
                            </div>
                            <span className="text-xs font-semibold text-slate-300">Guardians</span>
                        </button>

                        <button onClick={() => setView('helplines')} className="glass-card p-4 rounded-2xl flex flex-col items-center gap-3 active:scale-95 group">
                            <div className="p-3 rounded-full bg-emerald-500/10 text-emerald-400 group-hover:bg-emerald-500/20 transition-colors">
                                <Icon name="Phone" className="w-6 h-6" />
                            </div>
                            <span className="text-xs font-semibold text-slate-300">Helplines</span>
                        </button>

                        <button onClick={toggleSiren} className={`glass-card col-span-2 p-4 rounded-2xl flex items-center justify-between px-6 active:scale-95 transition-all ${sirenOn ? 'bg-amber-500/20 border-amber-500/30' : ''}`}>
                            <div className="flex items-center gap-4">
                                <div className={`p-3 rounded-full ${sirenOn ? 'bg-amber-500 text-white animate-pulse' : 'bg-amber-500/10 text-amber-400'}`}>
                                    <Icon name={sirenOn ? "Volume2" : "Megaphone"} className="w-6 h-6" />
                                </div>
                                <div className="text-left">
                                    <span className={`block text-sm font-bold ${sirenOn ? 'text-white' : 'text-slate-200'}`}>Loud Siren</span>
                                    <span className="text-[10px] text-slate-400 uppercase tracking-wide">Disorient Attacker</span>
                                </div>
                            </div>
                            <div className={`w-3 h-3 rounded-full ${sirenOn ? 'bg-amber-500' : 'bg-slate-700'}`}></div>
                        </button>
                    </div>

                    {/* Rights Card */}
                    <button onClick={() => setView('rights')} className="mt-3 w-full glass-card p-5 rounded-2xl flex items-center justify-between active:scale-95 border-l-4 border-l-rose-400">
                        <div className="flex items-center gap-4">
                            <div className="p-2 bg-rose-500/10 rounded-lg text-rose-400"><Icon name="BookOpen" className="w-5 h-5" /></div>
                            <div className="text-left">
                                <span className="block text-sm font-bold text-white">Know Your Rights</span>
                                <span className="text-xs text-slate-400">Legal awareness story cards</span>
                            </div>
                        </div>
                        <Icon name="ChevronRight" className="w-4 h-4 text-slate-600" />
                    </button>
                </div>
            );
        };

        const RightsView = ({ onBack }) => {
            const rights = [
                { id: 1, title: "Zero FIR", desc: "File an FIR at any police station, regardless of location.", icon: "FileText", color: "indigo" },
                { id: 2, title: "No Arrest at Night", desc: "Women cannot be arrested after sunset & before sunrise without a magistrate.", icon: "Moon", color: "violet" },
                { id: 3, title: "Identity Privacy", desc: "Your identity must be kept confidential by police and media in sensitive cases.", icon: "EyeOff", color: "emerald" },
                { id: 4, title: "Free Legal Aid", desc: "You are entitled to free legal assistance for filing complaints.", icon: "Scale", color: "amber" }
            ];

            return (
                <div className="h-full flex flex-col px-6 pb-24 overflow-y-auto animate-in">
                    <div className="flex items-center gap-4 py-6">
                        <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                        <h2 className="text-lg font-semibold text-white">Your Rights</h2>
                    </div>
                    
                    <div className="grid gap-4">
                        {rights.map(r => (
                            <div key={r.id} className="glass-card p-5 rounded-2xl border-l-2 border-slate-700 hover:border-l-4 transition-all">
                                <div className="flex items-center gap-3 mb-2">
                                    <Icon name={r.icon} className={`w-5 h-5 text-${r.color}-400`} />
                                    <h3 className="font-bold text-white text-base">{r.title}</h3>
                                </div>
                                <p className="text-sm text-slate-400 leading-relaxed pl-8">{r.desc}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- PLACEHOLDER VIEWS ---
        const HelplinesView = ({ onBack }) => (
            <div className="h-full px-6 pt-6 animate-in">
                <div className="flex items-center gap-4 mb-6">
                    <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                    <h2 className="text-lg font-semibold text-white">Emergency Numbers</h2>
                </div>
                <div className="space-y-3">
                    {[
                        {n:"Police", p:"100", c:"text-blue-400", i:"Shield"}, 
                        {n:"Ambulance", p:"102", c:"text-emerald-400", i:"Activity"},
                        {n:"Women Helpline", p:"1091", c:"text-rose-400", i:"Heart"}
                    ].map((h, i) => (
                        <div key={i} className="glass-card p-4 rounded-2xl flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className={`p-2.5 rounded-full bg-slate-800 ${h.c}`}><Icon name={h.i} className="w-5 h-5" /></div>
                                <div><p className="text-white font-medium">{h.n}</p><p className="text-lg font-bold text-slate-300 tracking-wider">{h.p}</p></div>
                            </div>
                            <a href={`tel:${h.p}`} className="p-3 rounded-full bg-slate-800 text-white active:scale-95"><Icon name="Phone" className="w-5 h-5" /></a>
                        </div>
                    ))}
                </div>
            </div>
        );

        const MapView = ({ onBack }) => (
            <div className="h-full flex flex-col bg-[#020617] animate-in">
                <div className="p-6 flex items-center gap-4 z-10">
                    <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                    <h2 className="text-lg font-semibold text-white">Safe Map</h2>
                </div>
                <div className="flex-1 flex flex-col items-center justify-center opacity-50 relative overflow-hidden">
                    <div className="absolute inset-0 tech-grid opacity-20"></div>
                    <Icon name="Map" className="w-16 h-16 text-slate-600 mb-4" />
                    <p className="text-slate-500 font-medium">Map Module Offline</p>
                </div>
            </div>
        );

        const ProtocolView = ({ onBack }) => (
            <div className="h-full px-6 pt-6 animate-in">
                <div className="flex items-center gap-4 mb-6">
                    <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                    <h2 className="text-lg font-semibold text-white">Safety Protocols</h2>
                </div>
                <div className="glass-card p-5 rounded-2xl mb-3 border-l-4 border-emerald-500">
                    <h3 className="font-bold text-white mb-1">General Awareness</h3>
                    <p className="text-sm text-slate-400">Stay alert. Trust your instincts. Keep your phone charged.</p>
                </div>
                <div className="glass-card p-5 rounded-2xl mb-3 border-l-4 border-amber-500">
                    <h3 className="font-bold text-white mb-1">Harassment</h3>
                    <p className="text-sm text-slate-400">Move to a crowded area. Call 1091 immediately.</p>
                </div>
            </div>
        );

        const LegalView = ({ onBack }) => (
            <div className="h-full px-6 pt-6 animate-in">
                <button onClick={onBack} className="p-2 rounded-full glass-card text-slate-300 mb-6"><Icon name="ArrowLeft" className="w-5 h-5" /></button>
                <h1 className="text-2xl font-bold text-white mb-4">Legal & Privacy</h1>
                <div className="glass-card p-6 rounded-2xl text-slate-400 text-sm space-y-4">
                    <p><strong>Version:</strong> 2.0 (Stealth Edition)</p>
                    <p>This is a PWA designed for women's safety. Emergency features are simulated for demonstration.</p>
                    <div className="h-px bg-white/5 my-4"></div>
                    <p className="text-xs opacity-70">Data is stored locally on your device for privacy.</p>
                </div>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [menuOpen, setMenuOpen] = useState(false);
            const [ready, setReady] = useState(false);

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => { setUser(u); setReady(true); });
                setTimeout(() => { if (!ready) { setUser({displayName: 'Guest'}); setReady(true); } }, 2000);
                return () => unsub();
            }, [ready]);

            if (!ready) return <div className="h-screen bg-[#020617] flex items-center justify-center"><div className="loader-ring"></div></div>;

            return (
                <div className="h-screen w-full relative overflow-hidden bg-[#020617]">
                    <div className="absolute inset-0 tech-grid opacity-10 pointer-events-none"></div>
                    
                    {/* Navigation */}
                    <nav className="absolute top-0 left-0 right-0 h-20 px-6 flex items-center justify-between z-50">
                        <Logo />
                        <div className="relative">
                            <button onClick={() => setMenuOpen(!menuOpen)} className="p-2.5 rounded-full glass-card text-slate-300 hover:text-white transition-colors">
                                <Icon name={menuOpen ? "X" : "Menu"} className="w-6 h-6" />
                            </button>
                            {menuOpen && (
                                <div className="absolute right-0 top-16 w-64 glass-panel rounded-2xl p-2 flex flex-col gap-1 shadow-2xl animate-in z-50 border-l border-t border-white/10">
                                    {['home', 'contacts', 'helplines', 'rights', 'map', 'protocol', 'legal'].map(id => (
                                        <button key={id} onClick={() => { setView(id); setMenuOpen(false); }} className={`flex items-center gap-3 px-4 py-3.5 rounded-xl text-sm font-medium transition-all ${view === id ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-300 hover:bg-white/5'}`}>
                                            <span className="capitalize">{id}</span>
                                        </button>
                                    ))}
                                    <div className="h-px bg-white/10 my-1"></div>
                                    <button onClick={() => alert("Install PWA")} className="flex items-center gap-3 px-4 py-3.5 rounded-xl text-sm font-bold text-emerald-400 hover:bg-emerald-500/10"><Icon name="Download" className="w-4 h-4"/> Install App</button>
                                    <button onClick={() => { auth.signOut(); setMenuOpen(false); }} className="flex items-center gap-3 px-4 py-3.5 rounded-xl text-sm font-bold text-rose-400 hover:bg-rose-500/10"><Icon name="LogOut" className="w-4 h-4"/> Sign Out</button>
                                </div>
                            )}
                        </div>
                    </nav>

                    <main className="h-full w-full pt-20 relative z-0">
                        {view === 'home' && <HomeView user={user} setView={setView} />}
                        {view === 'contacts' && <ContactsView user={user} onBack={() => setView('home')} />}
                        {view === 'helplines' && <HelplinesView onBack={() => setView('home')} />}
                        {view === 'rights' && <RightsView onBack={() => setView('home')} />}
                        {view === 'map' && <MapView onBack={() => setView('home')} />}
                        {view === 'protocol' && <ProtocolView onBack={() => setView('home')} />}
                        {view === 'legal' && <LegalView onBack={() => setView('home')} />}
                    </main>

                    {/* Exit Button */}
                    <button onClick={() => window.location.replace("https://www.google.com")} className="absolute bottom-6 right-6 z-40 bg-slate-800 text-slate-400 p-3 rounded-full shadow-lg border border-slate-700 active:scale-95 transition-all opacity-70 hover:opacity-100">
                        <Icon name="LogOut" className="w-5 h-5" />
                    </button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>
